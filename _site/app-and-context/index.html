<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>gstack_docs | Your app in Gstack context</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Your app in Gstack context">
  <meta property="og:url" content="">
  <meta property="og:description" content="">
  <meta property="og:site_name" content="gstack_docs">
  <meta property="og:image" content="">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="">
  <meta name="twitter:title" content="Your app in Gstack context">
  <meta name="twitter:description" content="">
  <meta name="twitter:image" content="">

  <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">

  <link type="text/css" rel="stylesheet" href="/assets/slate-theme.css">
  <link type="text/css" rel="stylesheet" href="/assets/application.css">
</head>
<body>
  <!--[if lt IE 8]>
      <p class="browserupgrade">You are using an <strong>outdated</strong>
      browser. Please <a href="http://browsehappy.com/">upgrade your browser</a>
      to improve your experience.</p>
  <![endif]-->

  <!-- HEADER -->
  <div id="header_wrap" class="outer">
      <header class="inner">
        <a id="forkme_banner" href="https://github.com/gstackio/gstack-docs">View on GitHub</a>

        <h1 id="project_title">Your app in Gstack context</h1>
        <h2 id="project_tagline"><em>“Do you want any ham with your mashed potatoe?”</em> – B.&nbsp;Gandon</h2>

      </header>
  </div>

  <!-- MAIN CONTENT -->
  <main role="main" id="main_content_wrap" class="outer">
    <section id="main_content" class="inner">
      <h2 id="the-stack-below-your-app">The stack below your app</h2>

<p>After <code class="highlighter-rouge">gk push</code>-ing your app in Gstack, three layers will be stacked to bring
it online, up and running.</p>

<ol>
  <li>A Warden container (Docker also possible)</li>
  <li>A root filesystem (misnamed “<a href="https://docs.cloudfoundry.org/concepts/stacks.html">Stack</a>”
in the Cloud Foundry parlance)</li>
  <li>A buildpack, that provides compilation, packaging, and runtime</li>
</ol>

<p>We detail these 3 layers in reverse order, starting with the “Buildpack” layer
that is the nearest from Gstack applications.</p>

<h3 id="a-buildpack-what-the--is-a-buildpack">A Buildpack. What the %!¿*?¡$ is a “Buildpack”??</h3>

<p>A “buildpack” is just a package that builds and run your application.</p>

<p>Buildpack make Gstack incredibly polyglot, because dozen of them have been
written so far. Even the most funkyest web technologies have a dedicated
buildpack! Gstack provides a bunch of the most popular and standard ones. But
you can choose to use any other very easily. When you <code class="highlighter-rouge">gk push</code> you
applications, you can specify your custom buildpack, usually with a mere
Github URL in the <code class="highlighter-rouge">manifest.yml</code>. Gstack will then proceed downloading and
using it for your app.</p>

<p>The design of buildpacks is very simple, which for sure participated to its
outstanding success.</p>

<ul>
  <li>A buildpack is either packaged as a <strong>git repository</strong>, or a <strong>zip archive</strong>.</li>
  <li>It must provide these 3 executable scripts:
    <ol>
      <li><code class="highlighter-rouge">bin/detect</code> that tells whether the buildpack can build and run a given
application.</li>
      <li><code class="highlighter-rouge">bin/compile</code> that builds the application, after this has run, your
application is completely ready to be started.</li>
      <li><code class="highlighter-rouge">bin/release</code> that explains the system how to run the application, and
especially the exact command line to run, and any required
<a href="https://en.wikipedia.org/wiki/Environment_variable">environement variables</a>
to provide.</li>
    </ol>
  </li>
  <li>The 3 scripts above will be called in sequence.
    <ul>
      <li>As input, they take specific environment variables.</li>
      <li>As output, they return specific exit codes, print plain text logs, or
dump some YAML-formatted properties.</li>
    </ul>
  </li>
</ul>

<p>Buildpacks were first designed by Heroku back in… well… a long time ago.
Considering their success, they were later adopted by Cloud Foundry. For more
details, go watch the <a href="http://talks.codegram.com/heroku-buildpacks">Heroku Buildpacks</a>
presentation. It’s definitely brilliant.</p>

<h3 id="a-root-filesystem">A Root Filesystem</h3>

<p>The root filesystem is a <code class="highlighter-rouge">.tgz</code> archive containing a basic collection of
files. There are the base system utilities and configs that the buildpack and
the application will have access to.</p>

<p>For example, it provides basic C and C++ compilers, and script engines like
<code class="highlighter-rouge">bash</code>, <code class="highlighter-rouge">perl</code>, <code class="highlighter-rouge">python</code>, <code class="highlighter-rouge">ruby</code>, <code class="highlighter-rouge">sh</code>. This is meant to be enough for you to
download and build any missing technology, whether mainstream like
<a href="http://www.oracle.com/technetwork/java/javase/downloads/">Java</a> or
<a href="https://golang.org/">Go</a>, or funky ones like <a href="https://github.com/pikelang/Pike">Pike</a>
or <a href="https://github.com/rust-lang/rust">Rust</a>.</p>

<p>The standard root filesystem in Gstack is called <code class="highlighter-rouge">cflinuxfs2</code>. It is based on
a stable Ubuntu Linux distribution and contains something like 21,000+ files.</p>

<p>When using Gstack, you can see which root file systems are available with the
command <code class="highlighter-rouge">gk stacks</code> (indeed, root filesystems are misnamed “stacks” in Cloud
Foundry). New versions are released <a href="https://github.com/cloudfoundry/stacks/releases">here</a>
from times to times. Only a Gstack admin can deploy a new version of a root
filesystem.</p>

<h3 id="a-container-warden-or-docker">A Container (Warden or Docker)</h3>

<p>Why not just <a href="https://www.docker.com/">Docker</a>?</p>

<blockquote>
  <p><a href="https://en.wikipedia.org/wiki/TL;DR">TL;DR</a>: Actually
Warden and Docker were created at the same time. Although they are
very similar container technologies, Warden is provided by Gstack
because historically, Warden has always been more in line with the
the use cases and requirements of the Cloud Foundry infrastructure,
which is the backbone of Gstack.</p>
</blockquote>

<p>Gstack is based on Cloud Foundry and historically, Cloud Foundry started
creating its own container technology, called
“<a href="https://github.com/cloudfoundry/warden">Warden</a>”, nearly at the same time
Docker did. They just didn’t met the same level of popularity.</p>

<p>Before Docker reached its outstanding success, Warden and Docker were both
obscure technologies, both following their own path as they were targeting
different audiences. To make long story short, Docker focused on human
end-users, whereas Warden was created to be controlled by machines, through an
external API.</p>

<p>For example, Docker said that containers would not control their network
settings because in their use cases, it was easier for end-users to have the
container engine impose consistent network settings to containers. Warden
didn’t do that because it didn”t make sense in its context. On the contrary,
Warden had to be managed by some external API, so that many Warden backends
can be managed by a central “brain” called “Cloud Controller”. An external API
was for sure no priority to Docker at the time, as a consequence of the
intended focus on real-user interactions.</p>

<p>This explains why applications that are pushed on Gstack using a buildpack,
are then deployed in Warden containeres. But thanks to the
<a href="https://github.com/cloudfoundry-incubator/diego">Diego</a> technology,
developers can also push full-blown Docker containers in Gstack.</p>

    </section>
  </main>

  <!-- FOOTER  -->
  <div id="footer_wrap" class="outer">
    <footer class="inner">
      <p>Built in <span style="font-family: 'Arial Unicode MS', 'Apple Symbols'; font-size: 130%;">☮</span> by <a href="http://gstack.io">Gstack</a>, with ♡ for you all.</p>
    </footer>
  </div>

  <script type="text/javascript" src="/assets/vendor.js"></script>
  <script type="text/javascript" src="/assets/application.js"></script>

  <script>
    (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
    function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
    e=o.createElement(i);r=o.getElementsByTagName(i)[0];
    e.src='https://www.google-analytics.com/analytics.js';
    r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
    ga('create','UA-74118635-1','auto');ga('send','pageview');
  </script>
</body>
</html>
